<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TR∆Ø·ªúNG AN DRIVING</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* --- C·∫§U H√åNH CHUNG --- */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f4f6f8; margin: 0; padding: 0; color: #333; }
        .container { max-width: 600px; margin: 0 auto; background: white; min-height: 100vh; padding-bottom: 50px; }
        
        /* HEADER (Xanh l√° chu·∫©n) */
        header { background-color: #28a745; padding: 15px; color: white; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .brand-name { font-weight: 900; font-size: 18px; text-transform: uppercase; margin: 0; }
        .hotline { font-size: 14px; color: #ffeb3b; font-weight: bold; text-decoration: none; display: block; margin-top: 2px; }
        .lang-grp { display: flex; gap: 5px; }
        .lang-btn { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.5); color: white; padding: 2px 6px; font-size: 12px; border-radius: 4px; cursor: pointer; }
        .lang-btn.active { background: white; color: #28a745; font-weight: bold; }

        /* SECTION STYLES */
        .section { padding: 15px; border-bottom: 10px solid #f4f6f8; }
        .sec-title { color: #28a745; font-weight: 700; font-size: 15px; text-transform: uppercase; margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between; }
        .sec-title i { margin-right: 5px; }
        
        /* N√∫t V·ªä TR√ç T√îI (G√≥c ph·∫£i) */
        .btn-myloc { color: #007bff; font-size: 13px; cursor: pointer; text-transform: none; display: flex; align-items: center; gap: 4px; }
        .btn-myloc i { color: #dc3545; }

        /* INPUT GROUPS */
        .form-group { margin-bottom: 12px; position: relative; }
        .form-label { font-size: 13px; font-weight: 600; color: #555; margin-bottom: 5px; display: block; }
        
        input, select, textarea { width: 100%; padding: 12px; padding-right: 80px; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; outline: none; transition: 0.3s; box-sizing: border-box; background: #fff; }
        input:focus, select:focus, textarea:focus { border-color: #28a745; box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1); }
        textarea { resize: none; height: 80px; padding-right: 12px; }

        /* N√öT TRONG INPUT (Icon Map & X√≥a) */
        .input-tools { position: absolute; right: 6px; top: 36px; display: flex; gap: 5px; }
        .tool-btn { width: 32px; height: 32px; border-radius: 6px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; transition: 0.2s; }
        
        .btn-clear { background: #f1f3f5; color: #888; display: none; } /* ·∫®n m·∫∑c ƒë·ªãnh */
        .btn-map { background: #28a745; color: white; box-shadow: 0 2px 5px rgba(40, 167, 69, 0.3); }
        .btn-map:active { transform: scale(0.95); }

        /* N√öT TH√äM ƒêI·ªÇM D·ª™NG */
        .btn-add-stop { width: 100%; background: none; border: 1px dashed #28a745; color: #28a745; padding: 10px; border-radius: 8px; font-weight: bold; cursor: pointer; margin-bottom: 10px; }
        
        /* N√öT T√çNH GI√Å (To, Xanh l√°) */
        .btn-calc { width: 100%; background: #28a745; color: white; padding: 15px; border: none; border-radius: 8px; font-size: 18px; font-weight: 900; text-transform: uppercase; cursor: pointer; box-shadow: 0 4px 10px rgba(40, 167, 69, 0.3); margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-calc:active { transform: scale(0.98); }

        /* G·ª¢I √ù ƒê·ªäA CH·ªà */
        .suggestions { position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #ddd; border-top: none; z-index: 100; max-height: 200px; overflow-y: auto; border-radius: 0 0 8px 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); display: none; }
        .sug-item { padding: 12px; border-bottom: 1px solid #f0f0f0; font-size: 14px; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .sug-item:hover { background: #f9f9f9; }
        .sug-item i { color: #888; }

        /* K·∫æT QU·∫¢ */
        #result-area { display: none; padding: 15px; background: #e8f5e9; border: 1px solid #c8e6c9; border-radius: 8px; margin-top: 20px; }
        .total-price { font-size: 24px; color: #dc3545; font-weight: 900; text-align: center; margin: 10px 0; }
        .detail-row { display: flex; justify-content: space-between; font-size: 14px; margin-bottom: 5px; border-bottom: 1px dashed #ccc; padding-bottom: 5px; }
        .strike { text-decoration: line-through; color: #999; font-size: 0.9em; margin-right: 5px; }

        /* ACTION BUTTONS */
        .action-grp { display: flex; gap: 10px; margin-top: 15px; }
        .act-btn { flex: 1; padding: 12px; border: none; border-radius: 6px; color: white; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .zalo { background: #0068ff; }
        .mail { background: #6c757d; }

        /* MODAL B·∫¢N ƒê·ªí */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 2000; justify-content: center; align-items: center; padding: 15px; }
        .modal-content { background: white; width: 100%; max-width: 500px; border-radius: 12px; overflow: hidden; display: flex; flex-direction: column; height: 70vh; }
        .modal-header { background: #28a745; color: white; padding: 12px 15px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .map-container { flex: 1; position: relative; }
        #picker-map { width: 100%; height: 100%; }
        .center-marker { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -100%); z-index: 1000; width: 36px; pointer-events: none; }
        .modal-footer { padding: 10px; background: white; text-align: center; }
        .btn-confirm { width: 100%; padding: 12px; background: #28a745; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }

        /* ·∫®n hi·ªán b·∫£n ƒë·ªì ch√≠nh */
        #route-map { height: 250px; width: 100%; border-radius: 8px; margin-top: 15px; display: none; border: 1px solid #ccc; }
    </style>
</head>
<body>

<header>
    <div>
        <h1 class="brand-name">TR∆Ø·ªúNG AN DRIVING</h1>
        <a href="tel:0847526893" class="hotline">‚òéÔ∏è 084.752.6893</a>
    </div>
    <div class="lang-grp">
        <button class="lang-btn active">VN</button>
        <button class="lang-btn">EN</button>
        <button class="lang-btn">CN</button>
    </div>
</header>

<div class="container">
    
    <div class="section">
        <div class="sec-title"><i class="fas fa-clipboard-list"></i> TH√îNG TIN</div>
        <div class="form-group">
            <label class="form-label">S·ªë ƒëi·ªán tho·∫°i:</label>
            <input type="tel" id="phone" placeholder="VD: 0912345678" style="padding-right: 40px;">
            <div class="input-tools" style="top: 32px;"><button class="tool-btn btn-clear" onclick="clearInp('phone')">‚úï</button></div>
        </div>
        <div class="form-group">
            <label class="form-label">Th·ªùi gian ƒë√≥n:</label>
            <input type="datetime-local" id="time" style="padding-right: 12px;">
        </div>
    </div>

    <div class="section">
        <div class="sec-title">
            <span><i class="fas fa-map-marked-alt"></i> L·ªò TR√åNH</span>
            <span class="btn-myloc" onclick="getMyLoc()"><i class="fas fa-crosshairs"></i> V·ªä TR√ç T√îI</span>
        </div>

        <div class="form-group">
            <label class="form-label">ƒêi·ªÉm ƒë√≥n:</label>
            <input type="text" id="pickup" placeholder="Nh·∫≠p ƒëi·ªÉm ƒë√≥n..." autocomplete="off">
            <div class="input-tools">
                <button class="tool-btn btn-clear" onclick="clearInp('pickup')">‚úï</button>
                <button class="tool-btn btn-map" onclick="openMapModal('pickup')"><i class="fas fa-map"></i></button>
            </div>
            <div class="suggestions"></div>
        </div>

        <div id="stops-container"></div>
        <button class="btn-add-stop" onclick="addStop()">+ Th√™m ƒëi·ªÉm d·ª´ng</button>

        <div class="form-group">
            <label class="form-label">ƒêi·ªÉm ƒë·∫øn:</label>
            <input type="text" id="dropoff" placeholder="Nh·∫≠p ƒëi·ªÉm ƒë·∫øn..." autocomplete="off">
            <div class="input-tools">
                <button class="tool-btn btn-clear" onclick="clearInp('dropoff')">‚úï</button>
                <button class="tool-btn btn-map" onclick="openMapModal('dropoff')"><i class="fas fa-map"></i></button>
            </div>
            <div class="suggestions"></div>
        </div>
    </div>

    <div class="section">
        <div class="sec-title"><i class="fas fa-car"></i> T√ôY CH·ªåN</div>
        <div class="form-group">
            <label class="form-label">Lo·∫°i xe:</label>
            <select id="carType">
                <option value="4">üöó Xe 4 ch·ªó (10k/km)</option>
                <option value="7">üöê Xe 7 ch·ªó (12k/km)</option>
            </select>
        </div>
        <div class="form-group">
            <label class="form-label">H√¨nh th·ª©c:</label>
            <select id="tripType" onchange="toggleWait()">
                <option value="1">‚û°Ô∏è 1 Chi·ªÅu</option>
                <option value="2">üîÑ 2 Chi·ªÅu (∆Øu ƒë√£i)</option>
            </select>
        </div>
        <div class="form-group" id="wait-group" style="display:none; background:#f8f9fa; padding:10px; border-radius:8px;">
            <label class="form-label">‚è≥ Th·ªùi gian ch·ªù (Mi·ªÖn ph√≠ 3h ƒë·∫ßu):</label>
            <input type="number" id="waitHour" value="0" style="padding-right:12px;">
        </div>
        <div class="form-group">
            <label class="form-label">T√†i x·∫ø:</label>
            <select id="driver">
                <option value="H·ªá th·ªëng">‚≠ê H·ªá th·ªëng (Nhanh nh·∫•t)</option>
                <option value="Thanh Loan">üë©‚Äçü¶∞ Thanh Loan</option>
            </select>
        </div>
        <div class="form-group">
            <label class="form-label"><i class="fas fa-pen"></i> Y√™u c·∫ßu/Ghi ch√∫:</label>
            <textarea id="note" placeholder="VD: ƒê√≥n ƒë√∫ng gi·ªù, xe s·∫°ch s·∫Ω..."></textarea>
        </div>

        <button class="btn-calc" id="btn-calc" onclick="calculate()">
            <i class="fas fa-calculator"></i> T√çNH GI√Å C∆Ø·ªöC
        </button>

        <div id="route-map"></div>

        <div id="result-area">
            <div style="text-align:center; color:#28a745; font-weight:bold;">GI√Å D·ª∞ KI·∫æN</div>
            <div class="total-price" id="res-total">0 ƒë</div>
            <div class="detail-row"><span>Qu√£ng ƒë∆∞·ªùng:</span> <strong id="res-km">0 km</strong></div>
            <div class="detail-row"><span>Th·ªùi gian:</span> <strong id="res-time">0 ph√∫t</strong></div>
            
            <div class="detail-row" id="row-back" style="display:none;">
                <span>Chi·ªÅu v·ªÅ (-40%):</span> <span id="res-back-val"></span>
            </div>
            <div class="detail-row" id="row-wait" style="display:none;">
                <span>Ph√≠ ch·ªù:</span> <strong id="res-wait">0 ƒë</strong>
            </div>
            <div class="detail-row" id="row-deposit" style="display:none; background:#fff3cd;">
                <span>ƒê·∫∑t c·ªçc (20%):</span> <strong style="color:#d32f2f;" id="res-deposit">0 ƒë</strong>
            </div>

            <div class="action-grp">
                <button class="act-btn zalo" onclick="book('zalo')"><i class="fas fa-comment"></i> ƒê·∫∂T ZALO</button>
                <button class="act-btn mail" onclick="book('mail')"><i class="fas fa-envelope"></i> G·ª¨I MAIL</button>
            </div>
        </div>
    </div>
</div>

<div id="map-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <span>Ch·ªçn v·ªã tr√≠</span>
            <span style="cursor:pointer;" onclick="closeModal()">‚úï</span>
        </div>
        <div class="map-container">
            <div id="picker-map"></div>
            <img src="https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png" class="center-marker">
        </div>
        <div class="modal-footer">
            <button class="btn-confirm" onclick="confirmLocation()">X√ÅC NH·∫¨N V·ªä TR√ç N√ÄY</button>
        </div>
    </div>
</div>

<script>
    // C·∫§U H√åNH
    const CFG = { p4: 10000, p7: 12000, wait: 50000 };
    let map, pickerMap, routeLayer, activeInput;
    let prices = {};

    // KH·ªûI T·∫†O
    window.onload = () => {
        // Map ch√≠nh (·∫©n)
        map = L.map('route-map').setView([10.7769, 106.7009], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        // Set th·ªùi gian
        let now = new Date(); now.setMinutes(now.getMinutes() + 30 - now.getTimezoneOffset());
        document.getElementById('time').value = now.toISOString().slice(0, 16);

        // G√°n s·ª± ki·ªán Input
        setupInput('phone');
        setupInput('pickup');
        setupInput('dropoff');
    };

    // X·ª¨ L√ù INPUT & G·ª¢I √ù (Fix l·ªói m·∫•t focus)
    function setupInput(id) {
        let el = document.getElementById(id);
        el.addEventListener('input', function() {
            toggleClear(this);
            if(id !== 'phone') searchAddr(this);
        });
        el.addEventListener('focus', function() { toggleClear(this); });
    }

    function toggleClear(inp) {
        let btn = inp.parentElement.querySelector('.btn-clear');
        if(btn) btn.style.display = inp.value ? 'flex' : 'none';
    }

    function clearInp(id) {
        let el = document.getElementById(id);
        el.value = ''; delete el.dataset.lat; delete el.dataset.lon;
        toggleClear(el);
    }

    // T√åM KI·∫æM ƒê·ªäA CH·ªà (NOMINATIM - Optimized)
    let timer;
    function searchAddr(inp) {
        clearTimeout(timer);
        let list = inp.parentElement.querySelector('.suggestions');
        if (!list) return; // B·∫£o v·ªá cho tr∆∞·ªùng h·ª£p phone
        
        if (inp.value.length < 3) { list.style.display = 'none'; return; }

        timer = setTimeout(() => {
            fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(inp.value)}&countrycodes=vn&limit=5`)
                .then(r => r.json())
                .then(data => {
                    list.innerHTML = '';
                    if (!data.length) { list.style.display = 'none'; return; }
                    
                    data.forEach(item => {
                        let div = document.createElement('div');
                        div.className = 'sug-item';
                        div.innerHTML = `<i class="fas fa-map-marker-alt"></i> ${item.display_name.split(',').slice(0,3).join(',')}`;
                        
                        // S·ª¨ D·ª§NG ONMOUSEDOWN ƒê·ªÇ TR√ÅNH M·∫§T FOCUS
                        div.onmousedown = (e) => {
                            e.preventDefault(); // Quan tr·ªçng: NgƒÉn b√†n ph√≠m ƒë√≥ng
                            inp.value = item.display_name;
                            inp.dataset.lat = item.lat;
                            inp.dataset.lon = item.lon;
                            list.style.display = 'none';
                            toggleClear(inp);
                        };
                        list.appendChild(div);
                    });
                    list.style.display = 'block';
                });
        }, 300);
    }

    // ·∫®n g·ª£i √Ω khi click ra ngo√†i
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.input-tools') && !e.target.closest('input')) {
            document.querySelectorAll('.suggestions').forEach(s => s.style.display = 'none');
        }
    });

    // B·∫¢N ƒê·ªí CH·ªåN V·ªä TR√ç (MODAL)
    function openMapModal(id) {
        activeInput = document.getElementById(id);
        document.getElementById('map-modal').style.display = 'flex';
        
        if (!pickerMap) {
            pickerMap = L.map('picker-map').setView([10.7769, 106.7009], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(pickerMap);
        }
        
        // Fix l·ªói hi·ªÉn th·ªã map
        setTimeout(() => {
            pickerMap.invalidateSize();
            if (activeInput.dataset.lat) {
                pickerMap.setView([activeInput.dataset.lat, activeInput.dataset.lon], 16);
            } else if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(p => pickerMap.setView([p.coords.latitude, p.coords.longitude], 15));
            }
        }, 200);
    }

    function closeModal() { document.getElementById('map-modal').style.display = 'none'; }

    function confirmLocation() {
        let center = pickerMap.getCenter();
        activeInput.dataset.lat = center.lat;
        activeInput.dataset.lon = center.lng;
        
        // Reverse Geocoding
        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${center.lat}&lon=${center.lng}`)
            .then(r => r.json())
            .then(d => {
                activeInput.value = d.display_name || `${center.lat.toFixed(5)}, ${center.lng.toFixed(5)}`;
                toggleClear(activeInput);
            });
        closeModal();
    }

    function getMyLoc() {
        if(!navigator.geolocation) return alert("Vui l√≤ng b·∫≠t GPS");
        let inp = document.getElementById('pickup');
        inp.placeholder = "ƒêang l·∫•y v·ªã tr√≠...";
        navigator.geolocation.getCurrentPosition(p => {
            let lat = p.coords.latitude, lon = p.coords.longitude;
            inp.dataset.lat = lat; inp.dataset.lon = lon;
            fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`)
                .then(r => r.json())
                .then(d => { inp.value = d.display_name; toggleClear(inp); });
        });
    }

    // ƒêI·ªÇM D·ª™NG
    function addStop() {
        let div = document.createElement('div');
        div.className = 'form-group';
        let id = 'stop-' + Date.now();
        div.innerHTML = `
            <input type="text" id="${id}" placeholder="Nh·∫≠p ƒëi·ªÉm d·ª´ng..." oninput="toggleClear(this); searchAddr(this)" onfocus="toggleClear(this)">
            <div class="input-tools">
                <button class="tool-btn btn-clear" onclick="this.parentElement.previousElementSibling.value=''; this.style.display='none'">‚úï</button>
                <button class="tool-btn" style="color:red; background:#fee;" onclick="this.parentElement.parentElement.remove()">üóëÔ∏è</button>
                <button class="tool-btn btn-map" onclick="openMapModal('${id}')"><i class="fas fa-map"></i></button>
            </div>
            <div class="suggestions"></div>`;
        document.getElementById('stops-container').appendChild(div);
    }

    // T√çNH GI√Å
    function toggleWait() {
        document.getElementById('wait-group').style.display = document.getElementById('tripType').value == '2' ? 'block' : 'none';
    }

    async function calculate() {
        let p = document.getElementById('pickup'), d = document.getElementById('dropoff');
        if (!p.dataset.lat || !d.dataset.lat) return alert("Vui l√≤ng ch·ªçn ƒë·ªãa ƒëi·ªÉm t·ª´ g·ª£i √Ω ho·∫∑c b·∫£n ƒë·ªì!");

        let btn = document.getElementById('btn-calc');
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ƒêANG T√çNH...'; btn.disabled = true;

        // Gom t·ªça ƒë·ªô
        let points = [p, ...document.querySelectorAll('#stops-container input'), d];
        let coords = points.filter(i => i.dataset.lat).map(i => `${i.dataset.lon},${i.dataset.lat}`).join(';');

        try {
            let res = await fetch(`https://router.project-osrm.org/route/v1/driving/${coords}?overview=full&geometries=geojson`);
            let data = await res.json();
            
            if (data.code !== 'Ok') throw 'Err';
            
            let r = data.routes[0];
            let km = r.distance / 1000;
            let mins = Math.round(r.duration / 60);

            // V·∫Ω Map
            if (routeLayer) map.removeLayer(routeLayer);
            routeLayer = L.geoJSON(r.geometry, { style: { color: 'blue', weight: 5 } }).addTo(map);
            map.fitBounds(routeLayer.getBounds(), { padding: [30, 30] });
            document.getElementById('route-map').style.display = 'block';

            // T√≠nh ti·ªÅn
            let type = document.getElementById('tripType').value;
            let unit = document.getElementById('carType').value == '4' ? CFG.p4 : CFG.p7;
            
            let go = Math.round(km * unit);
            let back = 0, wait = 0;
            let note = "";

            if (type == '2') {
                if (km >= 45) {
                    back = Math.round(go * 0.6); // Gi·∫£m 40%
                    note = `<span class="strike">${go.toLocaleString()}ƒë</span> <strong>${back.toLocaleString()}ƒë</strong>`;
                } else {
                    back = go;
                    note = `<strong>${back.toLocaleString()}ƒë</strong>`;
                }
                
                let h = parseFloat(document.getElementById('waitHour').value) || 0;
                if (h > 3) wait = (h - 3) * CFG.wait;
            }

            let total = go + back + wait;
            let deposit = (type == '2') ? Math.round(total * 0.2) : 0;

            // Hi·ªÉn th·ªã
            document.getElementById('result-area').style.display = 'block';
            document.getElementById('res-total').innerText = total.toLocaleString() + ' ƒë';
            document.getElementById('res-km').innerText = km.toFixed(1) + ' km';
            document.getElementById('res-time').innerText = mins + ' ph√∫t';
            
            let rBack = document.getElementById('row-back');
            if (type == '2') {
                rBack.style.display = 'flex';
                document.getElementById('res-back-val').innerHTML = note;
            } else rBack.style.display = 'none';

            let rWait = document.getElementById('row-wait');
            if (wait > 0) {
                rWait.style.display = 'flex';
                document.getElementById('res-wait').innerText = wait.toLocaleString() + ' ƒë';
            } else rWait.style.display = 'none';

            let rDep = document.getElementById('row-deposit');
            if (deposit > 0) {
                rDep.style.display = 'flex';
                document.getElementById('res-deposit').innerText = deposit.toLocaleString() + ' ƒë';
            } else rDep.style.display = 'none';

            // L∆∞u gi√° tr·ªã to√†n c·ª•c ƒë·ªÉ d√πng khi ƒë·∫∑t
            prices = { total, deposit };
            document.getElementById('result-area').scrollIntoView({ behavior: 'smooth' });

        } catch (e) { alert("Kh√¥ng t√¨m th·∫•y ƒë∆∞·ªùng ƒëi. Th·ª≠ l·∫°i!"); }
        
        btn.innerHTML = '<i class="fas fa-calculator"></i> T√çNH GI√Å C∆Ø·ªöC'; btn.disabled = false;
    }

    // ƒê·∫∂T XE
    function book(method) {
        let phone = document.getElementById('phone').value;
        if (!phone) return alert("Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i!");

        let info = {
            p: document.getElementById('pickup').value,
            d: document.getElementById('dropoff').value,
            t: document.getElementById('time').value.replace('T', ' '),
            c: document.getElementById('carType').selectedOptions[0].text,
            k: document.getElementById('tripType').selectedOptions[0].text,
            n: document.getElementById('note').value
        };

        // Link Maps (OSM)
        let lat1 = document.getElementById('pickup').dataset.lat;
        let lon1 = document.getElementById('pickup').dataset.lon;
        let linkMap = `https://www.openstreetmap.org/directions?engine=fossgis_osrm_car&route=${lat1}%2C${lon1}%3B${document.getElementById('dropoff').dataset.lat}%2C${document.getElementById('dropoff').dataset.lon}`;

        let msg = `üöñ ƒê·∫∂T XE TR∆Ø·ªúNG AN\nüìû ${phone}\nüïí ${info.t}\nüöò ${info.c}\nüîÑ ${info.k}\nüìç ${info.p}\nüèÅ ${info.d}\nüí∞ T·ªîNG: ${prices.total.toLocaleString()}ƒë`;
        
        if (prices.deposit > 0) msg += `\nüí≥ C·ªçc (20%): ${prices.deposit.toLocaleString()}ƒë`;
        if (info.n) msg += `\nüìù Ghi ch√∫: ${info.n}`;
        msg += `\nüó∫Ô∏è Map: ${linkMap}`;

        if (method == 'zalo') {
            navigator.clipboard.writeText(msg);
            alert("ƒê√£ copy ƒë∆°n! M·ªü Zalo...");
            window.open('https://zalo.me/0847526893');
        } else {
            window.location.href = `mailto:truongan.driving@gmail.com?body=${encodeURIComponent(msg)}`;
        }
    }
</script>

</body>
</html>
